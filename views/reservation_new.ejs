<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <!-- Fontawesome -->
    <script src="https://kit.fontawesome.com/acfe1c41fb.js" crossorigin="anonymous"></script>
     <!-- bootstrap -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>  

    <style>
        :root {
            --accent-color:  #E5874A;
            --box-color: #e3e3e3;
            }
        ol, ul{
            list-style: none;
        }
        #reservation{
            margin-top: 130px;
            margin-bottom: 100px;
        }
        #reservation .box{
            position: relative;
            margin-bottom: 10px;
            padding: 0px 25px;
            border: 1px solid var(--box-color);
        }
        /* #reservation .left{
            float: left;
            width: 445px;
            margin-right: 10px;
        }
        #reservation .right{
            float: left;
            width: 445px;
        } */
        .calendar{
            width: 95%;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }

        .calendar input{
            text-align: center;
            border-style: none;
            width: 60px;
            font-weight: 500;
            font-size: 25px;
        }
        .calendar select{
            text-align: center;
            appearance: none;
            border-style: none;
            font-weight: 500;
            font-size: 25px;
        }
        .calendar i{
            position: relative;
            bottom: 1.8px;
            margin: 4px;
            color: var(--accent-color);
        }
        .calendar thead td{
            color: gray;
        }

        #reservation h5{
            border-bottom: 1px solid var(--box-color);
            font-size: 16px;
            font-weight: bold;
            line-height: 56px;
            margin-bottom: 0px;
        }

        #reservation h5 input[type='checkbox']{
            position: absolute;
            left: -300%;
            /* display: none; */
        }
        
        #reservation h5 input[type='checkbox'] + label:before{
            content: "";
            display: inline-block;
            margin: 0 7px 0 0;
            width: 25px;
            height: 25px;
            border: 1px solid var(--box-color);
            border-radius: 30px;
            background-color: white;
            vertical-align: -6px;
        }
        #reservation h5 input[type='checkbox']:checked + label:before{
            background: var(--accent-color) url(/static/img/white-check-mark-icon.png) no-repeat center/ 15px auto;
            border-color: var(--accent-color);
        }
        #reservation h5 span.note{
            float: right;
            color: #7b7b7b;
            font-size: 12px;
            font-weight: normal;
        }
        #reservation h5 span.note.mg{
            padding-right: 33px;
        }
        #reservation ul{
            padding-left: 0;
        }
        #reservation .agree_list{
            margin: 15px 0;
        }
        #reservation .agree_list>li{
            font-size: 12px;
            line-height: 48px;
            border-top: 1px solid var(--box-color);
        }
        #reservation .agree_list>li:first-child{
            border-top: none;
        }
        #reservation .agree_list>li span{
            margin-right: 21px;
        }
        #reservation .list_style{
            /* display: block; */
            font-size: 12px;
            margin: 15px 0px;
            padding: 14px 12px;
        }
        #reservation .list1{
            border-top: 1px solid var(--box-color);
            border-bottom: 1px solid var(--box-color);
        }
        #reservation .agree_cont{
            margin: 0px 13px;
            /* border-top: 1px solid var(--box-color); */
            font-size: 12px;
            line-height: 16px;
        }
        #reservation .agree_cont p{
            margin-bottom: 10px;
        }
        #reservation .btn_open{
            float: right;
            color: #d71343;
            font-size: 12px;
            position: relative;
            right: 1px;
        }
        #reservation .btn_open.mg{
            position: absolute;
            top: 19px;
            right: 25px;
        }
        
        /* 기능 */
        .hidden{
            height: 0px;
            overflow-y: hidden;
            transition: 1s;
        }
    </style>
</head>
<body>
    <%-include("navbar_test.ejs")%>

    <div id="wrapper">
        <div class="container" id="reservation">
            <h4>실시간 예약</h4>
            <hr>
            <div class="row">
                <div class="left col-12 col-lg-6">
                    <div class="box" id="reservation1">
                        <h5>예약날짜 선택</h5>
                        <div class="calendar">
                            <div>
                                <i class="fa fa-chevron-left" onclick="changeMonth(-1);"></i>
                                <input type="text" id="year" value="2020">
                                <!-- 위에 부분 class가 부트스트랩에서 사용되고 있는 class인데 디자인을 바꿀 거면 class를 바꿔야 함 -->
                                <select id="month" onchange="changeMonth();">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                    <option value="7">7</option>
                                    <option value="8">8</option>
                                    <option value="9">9</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                </select>
                                <i class="fa fa-chevron-right" onclick="changeMonth(+1);"></i>
                            </div>
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <td>Sun</td>
                                        <td>Mon</td>
                                        <td>Tue</td>
                                        <td>Wed</td>
                                        <td>thu</td>
                                        <td>Fri</td>
                                        <td>Sat</td>
                                    </tr>
                                </thead>
                                <tbody id="tb_body"></tbody>
                            </table>
                        </div>
                        <ul>
                            <li>
                                <label for="r_date">입실날짜</label>
                                <input type="text" id="input_date" placeholder="날짜는 달력에서 선택하세요.">
                            </li>
                            <li>
                                <label for="r_date">퇴실날짜</label>
                                <input type="text" id="output_date" placeholder="날짜는 달력에서 선택하세요.">
                            </li>
                            <button type="button" onclick="rst();">초기화</button>
                        </ul>
                    </div>

                    <div class="box" id="reservation2">
                        <h5>텐트 선택</h5>
                        <select id="tent_type">
                            <option value="1">tent1</option>
                            <option value="2">tent2</option>
                            <option value="3">tent3</option>
                            <option value="4">tent4</option>
                        </select>
                    </div>
                </div>
                <div class="right col-12 col-lg-6">
                    <div class="box" id="reservation3">
                        <h5>예약자 정보</h5>
                        <ul class="person">
                            <li>
                                <h6>예약자명</h6>
                                <input type="text" id="name" name="name" placeholder="예약자명과 입금자명은 동일해야 합니다.">
                            </li>
                            <li>
                                <h6>연락처</h6>
                                <input type="text" id="phone" name="phone" placeholder="010-0000-0000">
                            </li>
                            <li>
                                <h6>이메일(선택)</h6>
                                <input type="text" id="email" name="email">
                            </li>
                            <li>
                                <h6>방문수단</h6>
                                <input type="radio" id="car" name="visitway">차량
                                <input type="radio" id="walk" name="visitway">도보
                                <input type="text" placeholder="띄어쓰기 없이 7~8자리 모두 입력해주세요.">
                                <ul class="msg">
                                    <li>* 주차할 차량 번호 7~8자리 모두 입력하세요.</li>
                                    <li>* 정확하게 입력하셔야 차단기가 열립니다.</li>
                                    <li>* 차량 한 대만 주차가 가능합니다.</li>
                                </ul>
                            </li>
                            <li>
                                <h6>방문인원수</h6>
                                <input type="number" id="rcnt" name="rcnt" value="1" max="6" min="1">
                                <em>명</em>
                            </li>
                        </ul>
                    </div>
                    <div class="box" id="reservation4">
                        <h5>
                            <input type="checkbox" name="agreeAll" id="agreeAll">
                            <label for="agreeAll">전체동의</label>
                            <!-- 전체동의 -->
                            <span class="note">필수동의</span>
                            <!-- 필수동의 -->
                        </h5>
                        <h5>
                            <input type="checkbox" name="agree1" id="agree1">
                            <label for="agree1">이용자 약관 전체동의</label>
                            <!-- 이용자 약관 전체동의 -->
                            <span class="note">필수동의</span>
                        </h5>
                        <ul class="agree_list">
                            <li>
                                <span>01</span>
                                <span>개인정보 수집이용 동의</span>
                                <!-- 개인정보 수집이용 동의 -->
                                <a class="btn_open">보기</a>
                                <div id="agree_cont1" class="agree_cont hidden">
                                    <p>메이크티켓의 서비스 이용과 관련하여 본인은 동의 내용을 숙지하였으며, 이에 따라 귀사(스마틱스 주식회사)가 본인의 개인정보를 아래와 같이 수집하는 것에 대해 동의합니다.
                                    </p>
                                    <ul class="list_style list1">
                                        <li>
                                            - 수집항목 : 이름, 휴대폰번호, 이메일 주소(선택)
                                        </li>
                                        <li>
                                            - 수집/이용 목적 : 예약 확인/취소/발권에 따른 본인확인 및 서비스 관련 고지사항 전달을 위한 의사소통 경로 확보
                                        </li>
                                        <li>
                                            - 보유 및 이용기간 : 전자상거래에서의 계약, 청약철회, 대금결제, 재화 등 공급기록 5년 
                                        </li>
                                    </ul>
                                    <p>
                                        ※ 본 동의는 서비스의 본질적 기능 제공을 위한 개인정보 수집/이용에 대한 동의로서, 동의하지 않으실 경우 서비스 제공이 불가능합니다.
                                    </p>
                                    <p>
                                        ※ 법령에 따른 개인정보의 수집/이용, 계약의 이행/편의증진을 위한 개인정보 취급과 관련된 일반 사항은 서비스의 개인정보 취급방침을 따릅니다.
                                    </p>
                                </div>
                            </li>
                            <li>
                                <span>02</span>
                                <span>만 14세 이상에 동의</span>
                                <!-- 만 14세 이상에 동의 -->
                                <a class="btn_open">보기</a>
                                <div id="agree_cont2" class="agree_cont hidden">
                                    만 14세 이상 동의 전문 (필수동의) 본 서비스는 전자상거래 결제 특성상 만 14세 이상만 이용 가능합니다. 만 14세 이상임을 확인합니다.
                                </div>
                                <!-- 만 14세 이상 이용가능 문구 -->
                            </li>
                        </ul>
                    </div>
                    <!-- 광고성 정보수신 동의 미노출 -->
                    <div class="box">
                        <h5>
                            <input type="checkbox" name="agree2" id="agree2">
                            <label for="agree2">광고성 정보수신 동의</label>
                            <!-- 광고성 정보수신 동의 -->
                            <span class="note mg">선택동의</span>
                            <!-- 선택동의 -->
                        </h5>
                        <a class="btn_open mg">보기</a>
                        <!-- 보기 -->
                        <div id="agree_cont3" class="agree-cont list_style nobd hidden">
                            <p>
                                메이크티켓의 서비스와 관련하여, 본인은 서비스에서 본인에게 전자적 전송매체를 통해, 마케팅 등의 목적으로 개인에게 최적화된 광고 또는 정보를 다음과 같이 전송하는 것에 동의합니다.
                            </p>
                            <p>
                                서비스에서는 고객이 수집 및 이용에 동의한 개인정보를 활용하여, 전자적 전송매체(SMS/MMS/e-mail 등 다양한 전송매체)를 통해 (주)스마틱스 및 제 3자의 상품 또는 서비스에 대한 개인 맞춤형 광고 및 정보를 전송할 수 있습니다. 고객이 본 수신동의를 철회하고자 할 경우 고객상담(02-866-6480)으로 연락하여 수신동의 철회를 할 수 있습니다.
                            </p>
                            <p>
                                * 본 동의는 선택동의로서 동의하지 않더라도 서비스 이용이 가능합니다. 
                            </p>
                        </div>
                    </div>
                    <div class="box">
                        <h5>
                            <input type="checkbox" name="agree3" id="agree3">
                            <label for="agree3">취소/환불규정 동의</label>
                            <!-- 취소/환불규정 동의 -->
                            <span class="note mg">필수동의</span>
                            <!-- 필수동의 -->
                        </h5>
                        <a class="btn_open mg">보기</a>
                        <!-- 보기 -->
                        <div id-="agree_cont4" class="list_style nobd hidden">
                            <p>
                                * 인터넷 예약취소는 인터넷을 통해서만 취소가 가능합니다.
                                <br>
                                * 예약취소는 취소일자에 따라 일정률의 취소 수수료가 이용자에게 부과됩니다.
                            </p>
                            <p>
                                이용일 7일전까지 취소 시, 100%환불
                                <br>
                                이용일 6일전까지 취소 시, 80%환불
                                <br>
                                이용일 5일전까지 취소 시, 60%환불
                                <br>
                                이용일 4일전까지 취소 시, 50%환불
                                <br>
                                이용일 3일전까지 취소 시, 40%환불
                                <br>
                                이용일 2일전까지 취소 시, 30%환불
                                <br>
                                이용일 1일전까지 취소 시, 20%환불
                                <br>
                                이용일 당일 취소 시, 0%환불
                            </p>
                        </div>
                    </div>
                    <div class="box">
                        <h5>결제 시 유의사항</h5>
                        <!-- 결제 시 유의사항 -->
                        <ul class="list_style nobd">
                            <li>
                                - 결제 시, 사용 업체는 (주)캠팡으로 표시됩니다.
                            </li>
                            <li>
                                - 결제 완료 후 모바일티켓이 휴대폰으로 전송됩니다.
                                <br>
                                (e-mail 주소를 입력하신 분만 예약 내역 메일을 받아 볼 수 있습니다.)
                            </li>
                            <li>
                                - 거래 영수증 확인 및 예약 취소는 예약내역 페이지에서 확인 가능합니다.
                            </li>
                        </ul>
                        <div class="box">
                            <h5 class="bs">
                                <span>결제 예정금액</span>
                                <!-- 결제 예정금액 -->
                                <strong class="price" id="div_total_amount">0원</strong>
                                <!-- 0원 -->
                            </h5>
                        </div>
                    </div>
                </div>
            </div>
            <div class="btn_area" id="paybtn_layer">
                <a href="#" class="paybtn">예약하기</a>
                <!-- 결제하기/예약하기 -->
            </div>
        </div>
        <!-- end contents -->
    </div>

    <%-include("footer.ejs")%>

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>

    <script>
        // 윤년 계산
        function checkLeapYear(year){
            if(year%400 == 0){
                return true;
            }
            else if(year%100 == 0){
                return false;
            }
            else if(year%4 == 0){
                return true;
            }
            else{
                return false;
            }
        }

        function getFirstDayOfWeek(year, month){
            if(month < 10) month = "0" + month;

            return(new Date(year+"-"+month+"-01")).getDay();
        }

        function changeYearMonth(year, month){
            let month_day = [31,28,31,30,31,30,31,31,30,31,30,31];

            if(month == 2){
                if(checkLeapYear(year)) month_day[1] = 29;
            }

            let first_day_of_week = getFirstDayOfWeek(year, month);
            let arr_calendar = [];

            // 앞에 비어있는 부분
            for(let i=0; i<first_day_of_week; i++){
                arr_calendar.push("");
            }
            
            // 가운데
            for(let i=1; i<month_day[month-1]; i++){
                arr_calendar.push(String(i));
            }

            // 뒤에 비어있는 부분
            let remain_day = 7 - (arr_calendar.length%7);
            if(remain_day < 7 ){
                for(let i=0; i<remain_day; i++){
                    arr_calendar.push("");
                }
            }
            
            renderCalendar(arr_calendar);
            // console.log(arr_calendar);
        }
        function renderCalendar(data){
            let h = [];
            for(let i=0; i<data.length; i++){
                if(i==0){
                    h.push('<tr>');
                }
                else if(i%7 == 0){
                    h.push('</tr>');
                    h.push('<tr>');
                }
                h.push('<td class="td' + data[i] + '" onclick="setDate(' + data[i] + ');" style="cursor:pointer;">' + data[i] + '</td>');
            }
            
            h.push('</tr>');

            $("#tb_body").html(h.join(""));
        }
        // 실시간 예약 input1 input2에 집어넣기
        function setDate(day){
            // if(day < 10) day = "0" + day;

            var input_date_value = $("#input_date").val();
            var output_date_value = $("#output_date").val();
            if(output_date_value != ''){
                // $(".td" + day).css({"background-color":"white"});
                // 순서가 문제였다~
            }
            else if(input_date_value == ''){
                $("#input_date").val(current_year + "-" + current_month + "-" + day);
                $(".td" + day).css({"background-color":"rgba(229, 135, 74, 0.7)"});
                // var inputdate = ".td"+String(Number(day));
                // var inputdate = (Number(day));
                // console.log(day, inputdate);
            }
            else if(input_date_value != ''){
                $("#output_date").val(current_year + "-" + current_month + "-" + day);
                var output_date = ".td" + day
                $(".td" + day).css({"background-color":"rgba(229, 135, 74, 0.7)"});
                // $("#" + inputdate ~ "#" + outputdate).css({"background-color":"blue"});
                // var outputdate = ".td"+String(Number(day));
                var outputday = (Number(day));
                // console.log(day, outputdate);

                // console.log(input_date_value.split('-')[2]);
                var inputday = input_date_value.split('-')[2];
                // console.log(inputday);
                // console.log(outputday);
                for( let i=Number(inputday)+1; i<outputday; i++){
                    $(".td"+i).css({"background-color":"rgba(229, 135, 74, 0.5)"});
                }

                // $(".td" + String(Nusmber(day)-1)).css({"background-color":"blue"});
                // 초기화 누르면 색깔 부분도 다시 원상복구
            }
        }

        function rst(){
            $("td").css({"background-color":"white"});
            $("#input_date").val("");
            $("#output_date").val("");
        }
    

        function changeMonth(diff){
            if(diff == undefined){
                current_month = parseInt($("#month").val());
            }
            else{
                current_month = current_month + diff;

                if(current_month == 0){
                    current_year = current_year -1;
                    current_month = 12
                }
                else if(current_month == 13){
                    current_year = current_year + 1;
                    current_month = 1;
                }
            }

            loadCalendar();
        }

        function loadCalendar(){
            $("#year").val(current_year);
            $("#month").val(current_month);
            changeYearMonth(current_year,current_month);
        }


        let current_year = (new Date()).getFullYear();
        let current_month = (new Date()).getMonth() +1;

        $("#year").val(current_year);
        $("#month").val(current_month);

        changeYearMonth(current_year,current_month);

        
        // 기능

        $(".btn_open").click(function(){
            var hidden = $(this).next();
            console.log($(hidden).height())
            if($(hidden).css("height")=="0px"){
                $(hidden).css({"height": hidden[0].clientHeight+"px"});
            }
            else{
                $(hidden).css({"height":"0px"});
            }
        })

        // 전체동의
        // $("#agreeAll").click(function(){
        //     if($("input[type=checkbox]").attr("checked")==false){
        //     $("input[type=checkbox]").attr("checked", true);
        //     }
        //     else{
        //     $("input[type=checkbox]").attr("checked", false);
        //     }
        // })

        $("#agreeAll").click(function(){
            console.log($("#agreeAll").prop("checked"))
            if(!$("#agreeAll").prop('checked')){
                $("input[type=checkbox]").prop("checked", false);
            }
            else {
                $("input[type=checkbox]").prop("checked", true);
            }
        })


    </script>
</body>
</html>